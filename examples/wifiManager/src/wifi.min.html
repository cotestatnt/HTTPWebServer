<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WiFi Manager</title>
    <style>
        .page-title{display:flex;justify-content:space-between;align-items:center;width:100%}.btn,nav a{text-decoration:none}form,table{margin:20px 0}.btn,.tab{cursor:pointer}.tab-content.active,label{display:block}:root{--primary-color:#06c;--primary-dark:#004c99;--danger-color:#c00;--success-color:#28a745;--warning-color:#ffc107;--light-bg:#f5f5f5;--border-color:#ddd;--text-color:#333}*{box-sizing:border-box;margin:0;padding:0}body{font-family:Arial,sans-serif;background:var(--light-bg);color:var(--text-color);line-height:1.6}.page-container{max-width:900px;margin:50px auto;padding:20px;background:#fff;border-radius:10px;box-shadow:0 4px 8px rgba(0,0,0,.1)}.btn,nav{background:var(--primary-color);color:#fff}.container{max-width:800px;margin:0 auto;padding:20px}h1,h2,h3{margin-bottom:15px;margin-right:20px;}h1{color:#fff}nav{padding:10px 0;margin-bottom:20px}nav .container{display:flex;justify-content:space-between;align-items:center}nav a{color:#fff;margin:0 10px}.btn{display:inline-block;padding:10px 15px;border-radius:4px;margin:10px 10px 10px 0;border:none;font-size:14px}.btn:hover{background:var(--primary-dark)}.btn-danger,.signal-weak{background:var(--danger-color)}.btn-danger:hover{background:#a00}table{width:100%;border-collapse:collapse}table,td,th{border:1px solid var(--border-color)}td,th{padding:10px;text-align:left}th{background:#f2f2f2}label{margin:10px 0 5px}input[type=password],input[type=text]{width:100%;padding:8px;margin-bottom:10px;border:1px solid var(--border-color);border-radius:4px}.static-ip{margin-top:15px;padding:15px;background:#f9f9f9;border:1px solid var(--border-color);border-radius:4px}.signal-excellent,.signal-good{background:var(--success-color)}.signal-strength{display:inline-block;width:25px;height:15px;margin-right:5px;vertical-align:middle}.checkbox-container input,.spinner{margin-right:10px}.signal-good{opacity:.7}.signal-fair{background:var(--warning-color)}.panel{background:#fff;border-radius:5px;padding:20px;margin-bottom:20px;box-shadow:0 1px 3px rgba(0,0,0,.1)}.status{padding:10px;background:#f9f9f9;border-radius:4px;margin-bottom:15px}.hidden,.tab-content{display:none}.tabs{display:flex;border-bottom:1px solid var(--border-color);margin-bottom:20px}.tab{padding:10px 15px}.tab.active{border-bottom:2px solid var(--primary-color);font-weight:700}.spinner{display:inline-block;width:20px;height:20px;border:3px solid rgba(0,0,0,.1);border-radius:50%;border-top-color:var(--primary-color);animation:1s linear infinite spin}@keyframes spin{to{transform:rotate(360deg)}}.message{padding:10px;border-radius:4px;margin:10px 0}.message.error{background-color:#f8d7da;color:#721c24;border:1px solid #f5c6cb}.message.success{background-color:#d4edda;color:#155724;border:1px solid #c3e6cb}.checkbox-container{display:flex;align-items:center;margin:10px 0}
    </style>
</head>
<body>
    <div class="page-container"><nav><div class="page-title"><h1><a href="https://github.com/cotestatnt/HTTPWebServer">HTTP Web Server</a></h1><h1>WiFi Manager</h1></div></nav><div class="container"><div id="message-container"></div><div id="tab-home" class="tab-content active"><div class="panel"><h2>Configure WiFi Network</h2><div id="connection-status" class="status"></div><button id="btn-scan" class="btn">Scan Networks</button><form id="wifi-form"><h3>Manual Connection</h3><label for="ssid">SSID:</label><input type="text" id="ssid" name="ssid" required><label for="password">Password:</label><input type="password" id="password" name="password"><div class="checkbox-container"><input type="checkbox" id="use-static" name="useStatic"><label for="use-static">Use Static IP</label></div><div id="static-ip-fields" class="static-ip hidden"><label for="ip">IP Address:</label><input type="text" id="ip" name="ip" placeholder="192.168.1.100"><label for="gateway">Gateway:</label><input type="text" id="gateway" name="gateway" placeholder="192.168.1.1"><label for="subnet">Subnet Mask:</label><input type="text" id="subnet" name="subnet" placeholder="255.255.255.0"><label for="dns1">Primary DNS (optional):</label><input type="text" id="dns1" name="dns1" placeholder="8.8.8.8"><label for="dns2">Secondary DNS (optional):</label><input type="text" id="dns2" name="dns2" placeholder="8.8.4.4"></div><button type="submit" class="btn">Save and Connect</button></form></div></div><div id="tab-scan" class="tab-content"><div class="panel"><h2>Available WiFi Networks</h2><div id="scan-status"><div class="spinner"></div>Scanning...</div><div id="networks-list"></div><button id="btn-back-home" class="btn">Back</button></div></div><div id="tab-info" class="tab-content"><div class="panel"><h2>Connection Information</h2><div id="info-content"></div><button id="btn-back-home2" class="btn">Back</button></div></div></div></div>
    <script>
        const wifiManager={connected:!1,connectionInfo:{ssid:"",bssid:"",rssi:0,ip:"",subnet:"",gateway:"",dns:"",mac:""},networks:[],scanning:!1,async fetchConnectionStatus(){try{const t=await makeApiCall("/wifi/info");return this.connected=t.connected,t.connected&&(this.connectionInfo=t.info),t}catch(t){return showMessage("Error loading status","error"),console.error("Error fetching connection status:",t),{connected:!1}}},async scanNetworks(){this.scanning=!0,view.updateScanUI();try{const t=await makeApiCall("/wifi/scan");return this.networks=t.networks,this.scanning=!1,t.networks}catch(t){return showMessage("Error during scan","error"),console.error("Error scanning networks:",t),this.scanning=!1,[]}finally{view.updateScanUI()}},async saveWiFiSettings(t){try{return"ok"===(await makeApiCall("/wifi/save","POST",t,"application/x-www-form-urlencoded")).result?(this.connected=!0,this.connectionInfo.ssid=t.ssid,showMessage("Connection established successfully","success"),await this.fetchConnectionStatus(),!0):(showMessage("Unable to connect to network. Verify SSID and password.","error"),!1)}catch(t){return showMessage("An error occurred while saving settings","error"),console.error("Error saving WiFi settings:",t),!1}}},view={init(){this.setupEventListeners(),this.updateConnectionStatus()},setupEventListeners(){document.getElementById("use-static").addEventListener("change",(t=>{document.getElementById("static-ip-fields").classList.toggle("hidden",!t.target.checked)})),document.getElementById("btn-scan").addEventListener("click",(async t=>{t.preventDefault(),this.showTab("scan"),await controller.scanNetworks()})),document.getElementById("btn-back-home").addEventListener("click",(t=>{t.preventDefault(),this.showTab("home")})),document.getElementById("btn-back-home2").addEventListener("click",(t=>{t.preventDefault(),this.showTab("home")})),document.getElementById("wifi-form").addEventListener("submit",(async t=>{t.preventDefault(),await controller.saveWiFiSettings()}))},updateConnectionStatus(){const t=document.getElementById("connection-status");wifiManager.connected?t.innerHTML=`\n                        <p>Status: <strong>Connected</strong></p>\n                        <p>SSID: <strong>${wifiManager.connectionInfo.ssid}</strong></p>\n                        <p>IP Address: <strong>${wifiManager.connectionInfo.ip}</strong></p>\n                    `:t.innerHTML="\n                        <p>Status: <strong>Not connected</strong></p>\n                    "},updateScanUI(){const t=document.getElementById("scan-status"),e=document.getElementById("networks-list");if(wifiManager.scanning)t.innerHTML='<div class="spinner"></div> Scanning...',t.style.display="block",e.style.display="none";else if(t.style.display="none",e.style.display="block",0===wifiManager.networks.length)e.innerHTML="<p>No networks found.</p>";else{let t="\n                            <table>\n                                <tr>\n                                    <th>SSID</th>\n                                    <th>Signal</th>\n                                    <th>Security</th>\n                                    <th>Channel</th>\n                                    <th>Action</th>\n                                </tr>\n                        ";wifiManager.networks.forEach((e=>{let n;n=e.rssi>=-50?"signal-excellent":e.rssi>=-65?"signal-good":e.rssi>=-75?"signal-fair":"signal-weak",t+=`\n                                <tr>\n                                    <td>${e.ssid}</td>\n                                    <td>\n                                        <div class="signal-strength ${n}"></div>\n                                        ${e.rssi} dBm\n                                    </td>\n                                    <td>${e.encryption}</td>\n                                    <td>${e.channel}</td>\n                                    <td>\n                                        <button class="btn" onclick="controller.selectNetwork('${e.ssid}')">Select</button>\n                                    </td>\n                                </tr>\n                            `})),t+="</table>",e.innerHTML=t}},updateInfoTab(){const t=document.getElementById("info-content");wifiManager.connected?t.innerHTML=`\n                        <table>\n                            <tr><td>Status:</td><td>Connected</td></tr>\n                            <tr><td>SSID:</td><td>${wifiManager.connectionInfo.ssid}</td></tr>\n                            <tr><td>RSSI:</td><td>${wifiManager.connectionInfo.rssi} dBm</td></tr>\n                            <tr><td>IP:</td><td>${wifiManager.connectionInfo.ip}</td></tr>\n                            <tr><td>Subnet Mask:</td><td>${wifiManager.connectionInfo.subnet}</td></tr>\n                            <tr><td>Gateway:</td><td>${wifiManager.connectionInfo.gateway}</td></tr>\n                            <tr><td>DNS:</td><td>${wifiManager.connectionInfo.dns}</td></tr>\n                        </table>\n                    `:t.innerHTML='\n                        <p>Not connected to any WiFi network.</p>\n                        <button class="btn" onclick="view.showTab(\'home\')">Configure WiFi</button>\n                    '},showTab(t){document.querySelectorAll(".tab-link").forEach((e=>{e.classList.toggle("active",e.getAttribute("data-tab")===t)})),document.querySelectorAll(".tab-content").forEach((e=>{e.classList.toggle("active",e.id===`tab-${t}`)}))}},controller={async init(){await wifiManager.fetchConnectionStatus(),view.init()},async scanNetworks(){await wifiManager.scanNetworks()},async saveWiFiSettings(){const t=document.getElementById("wifi-form"),e=new URLSearchParams;if(e.append("ssid",t.querySelector("#ssid").value.trim()),e.append("password",t.querySelector("#password").value.trim()),e.append("useStatic",t.querySelector("#use-static").checked?"1":"0"),e.append("ip",t.querySelector("#ip").value.trim()),e.append("gateway",t.querySelector("#gateway").value.trim()),e.append("subnet",t.querySelector("#subnet").value.trim()),e.append("dns1",t.querySelector("#dns1").value.trim()),e.append("dns2",t.querySelector("#dns2").value.trim()),e.get("ssid")){if("1"===e.get("useStatic")){if(!isValidIPv4(e.get("ip"))||!isValidIPv4(e.get("gateway"))||!isValidIPv4(e.get("subnet")))return void showMessage("Invalid IP address, Gateway or Subnet","error");if(e.get("dns1")&&!isValidIPv4(e.get("dns1")))return void showMessage("Invalid DNS1","error");if(e.get("dns2")&&!isValidIPv4(e.get("dns2")))return void showMessage("Invalid DNS2","error")}await wifiManager.saveWiFiSettings(e.toString())}else showMessage("SSID cannot be empty","error")},selectNetwork(t){document.getElementById("ssid").value=t,view.showTab("home")}};function showMessage(t,e="success"){const n=document.getElementById("message-container"),s=document.createElement("div");s.className=`message ${e}`,s.textContent=t,n.innerHTML="",n.appendChild(s),setTimeout((()=>{s.remove()}),5e3)}function isValidIPv4(t){if(!t)return!1;return/^(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)$/.test(t)}async function makeApiCall(t,e="GET",n=null,s="application/json"){const i={method:e,headers:{"Content-Type":s},mode:"cors",credentials:"same-origin"};!n||"POST"!==e&&"PUT"!==e||("application/json"===s?i.body=JSON.stringify(n):"application/x-www-form-urlencoded"===s&&(i.body=n));try{const e=await fetch(`${t}`,i);if(!e.ok)throw new Error(`HTTP error! status: ${e.status}`);return await e.json()}catch(t){throw console.error("API call failed:",t),t}}controller.init();
    </script>
</body>
</html>